@using System
@{
    var fullName = ViewBag.FullName as string ?? ViewData["FullName"] as string ?? "Sinh viên";
    var avatarUrl = ViewBag.AvatarUrl as string ?? ViewData["AvatarUrl"] as string;
    var notificationCount = ViewBag.NotificationCount as int? ?? ViewData["NotificationCount"] as int? ?? 0;

    string GetInitials(string name)
    {
        if (string.IsNullOrWhiteSpace(name))
        {
            return "SV";
        }

        var parts = name.Trim().Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 1)
        {
            return parts[0].Substring(0, Math.Min(2, parts[0].Length)).ToUpperInvariant();
        }

        var first = parts[0][0];
        var last = parts[^1][0];
        return ($"{char.ToUpperInvariant(first)}{char.ToUpperInvariant(last)}");
    }

    var initials = GetInitials(fullName);
}

<header class="student-header shadow-sm">
    <nav class="navbar navbar-expand-md navbar-dark bg-primary px-3">
        <button class="btn btn-outline-light d-md-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#studentSidebar" aria-controls="studentSidebar" aria-label="Mở menu">
            <i class="fa-solid fa-bars"></i>
        </button>

        <a class="navbar-brand d-flex align-items-center" href="/student/home">
            <img src="~/images/logo.jpg" class="logo img-fluid me-2" alt="Logo HUIT" />
        </a>

        <div class="ms-auto d-flex align-items-center gap-3">
            <a class="btn btn-icon position-relative text-white" href="/student/notifications" aria-label="Thông báo">
                <i class="fa-regular fa-bell fa-lg"></i>
                @if (notificationCount > 0)
                {
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        @notificationCount
                        <span class="visually-hidden">Thông báo chưa đọc</span>
                    </span>
                }
            </a>

            <div class="dropdown">
                <button class="btn btn-profile dropdown-toggle d-flex align-items-center" type="button" id="studentUserMenu" data-bs-toggle="dropdown" aria-expanded="false">
                    @if (!string.IsNullOrWhiteSpace(avatarUrl))
                    {
                        <img src="@avatarUrl" alt="Avatar sinh viên" class="avatar-image me-2" />
                    }
                    else
                    {
                        <span class="avatar-initials me-2">@initials</span>
                    }
                    <span class="d-none d-sm-inline">@fullName</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="studentUserMenu">
                    <li>
                        <a class="dropdown-item" href="/student/profile">
                            <i class="fa-regular fa-id-card me-2"></i>Hồ sơ của tôi
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="#changePasswordModal" data-bs-toggle="modal">
                            <i class="fa-solid fa-key me-2"></i>Đổi mật khẩu
                        </a>
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                        <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="dropdown-item text-danger">
                                <i class="fa-solid fa-right-from-bracket me-2"></i>Đăng xuất
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>