@using System
@{
    var fullName = ViewBag.FullName as string ?? ViewData["FullName"] as string ?? "Sinh viên";
    var avatarUrl = ViewBag.AvatarUrl as string ?? ViewData["AvatarUrl"] as string;
    var notificationCount = ViewBag.NotificationCount as int? ?? ViewData["NotificationCount"] as int? ?? 0;

    string GetInitials(string name)
    {
        if (string.IsNullOrWhiteSpace(name))
        {
            return "SV";
        }

        var parts = name.Trim().Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 1)
        {
            return parts[0].Substring(0, Math.Min(2, parts[0].Length)).ToUpperInvariant();
        }

        var first = parts[0][0];
        var last = parts[^1][0];
        return ($"{char.ToUpperInvariant(first)}{char.ToUpperInvariant(last)}");
    }

    var initials = GetInitials(fullName);
}

<header class="student-header shadow-sm">
    <div class="student-header__inner">
        <div class="student-header__left">
            <button class="student-header__toggle d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#studentSidebar" aria-controls="studentSidebar" aria-label="Mở menu">
                <i class="fa-solid fa-bars"></i>
            </button>

            <a class="student-header__brand" href="/student/home">
                <span class="sidebar-logo__dot"></span>
                <div class="student-header__brand-text">
                    <span class="student-header__brand-title">Cổng sinh viên</span>
                    <small class="student-header__brand-sub">Hệ thống điểm rèn luyện</small>
                </div>
            </a>
        </div>

        <div class="student-header__right">
            <a class="student-header__icon" href="/student/notifications" aria-label="Thông báo">
                <i class="fa-regular fa-bell"></i>
                @if (notificationCount > 0)
                {
                    <span class="student-header__badge">@notificationCount</span>
                }
            </a>

            <div class="dropdown">
                <button class="student-header__profile dropdown-toggle" type="button" id="studentUserMenu" data-bs-toggle="dropdown" aria-expanded="false">
                    @if (!string.IsNullOrWhiteSpace(avatarUrl))
                    {
                        <img src="@avatarUrl" alt="Avatar sinh viên" class="avatar-image" />
                    }
                    else
                    {
                        <span class="avatar-initials">@initials</span>
                    }
                    <span class="student-header__profile-name">@fullName</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="studentUserMenu">
                    <li>
                        <a class="dropdown-item" href="/student/profile">
                            <i class="fa-regular fa-id-card me-2"></i>Hồ sơ của tôi
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="#changePasswordModal" data-bs-toggle="modal">
                            <i class="fa-solid fa-key me-2"></i>Đổi mật khẩu
                        </a>
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                        <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="dropdown-item text-danger">
                                <i class="fa-solid fa-right-from-bracket me-2"></i>Đăng xuất
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</header>